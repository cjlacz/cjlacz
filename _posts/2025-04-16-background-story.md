# A little background

As I've gotten a bit more involved building my homelab, I thought I'd try and document some of it for myself. I don't have any expectations that it will get any attention. But we will see where it goes. 

I haven't had a nice computer setup at home in nearly 20 years. It has just been me a laptop for a long time now. I live in Japan. Apartments and houses are small.  There isn't central heating and air. The noise from a computer just can't really be isolated somewhere, let alone a homelab.  Those photos online are impressive, but I kind of feel pity for those living with them. 

What changed for me?  Kind of my new place got me more interested. Two main problems. One, the light switch setup is insane. Two, I couldn't get wifi to where I wanted my office, and this is in a 75 square meter apartment, about 800 square feet. The first led me to get started in smart homes, and the second led me on a Wifi upgrade journey where I learned quite a bit and ended up with some Unifi equipment. 

My new apartment has a hallway with three lights. One end has three switches, two of which control the hallway lights and not in a sane fashion. The other end controls two lights, the middle being the shared one. The other end has five switches together. I could never keep straight what controled what. One room didn't even have a light switch at all. 

This got me started in smart lightning. Initially Ikea, which didn't work well at the time. After debating for a while I went with Hue, which has been fantastic. Fortunately there seem to be a lot of solid solutions out there now that cost less money. It's a rental, so I can't (or shouldn't) replace the switches. But they are taped on and I have Hue switches controlling my lights.  Worked great using it with Apple home. Got my first motion sensors and realized they don't work like you expect, but worked through the problems and added a few to my place. All was good, until I tried to do more. Long story short, smart homes aren't smart. They weren't and they still aren't. Even with the fanciest Home Assistant setups, it's all fairly basic scripts. How smart it seems just depends on how much time you spent into writing them.  They aren't flexible, they don't learn and they most definitely aren't smart. Automated homes would have been a better name.  This got me interested in what it would take to make a home actually a bit intelligent. 

The wifi stuff was a bit easier. I got a better router that didn't work. Then I tried a mesh setup which kind of worked, but losing connection throughout the day and finally after several problems with zoom calls I gave up. Often when the mesh connection had problems it seemed I needed to hard reset that access point which led to long setup procedure again. Maybe 10 minutes or so. I eventually stopped using it. I finally wanted to use it again, along with VLANs which I learned about as part of my smart home journey and invested in some Unifi gear. I know there are plenty of complaints about it, but I wanted something that would have a high chance of working out of the box and give me new features to play with. It wasn't smooth sailing at first, but a couple days later seemed to iron that out. Eventually adding an access point I finally had my office available again.  A weak signal, but a consistent one. With it, I had a fairly decent layer 3 switch and access to some decent network speeds.

Apple Home eventually shows some of it's weakness when I try to automate my living room more intelligently. In a small place, it gets used for a lot of different things. Work, study, youtube, movies, dinner and more. Automating something that doesn't have regular use patterns isn't easy with the limited scripting that's available. I wanted to try Home Assistant as I thought it might solve some of my problems and bought and older Nuc 9 Extreme. 1 Gbe networking, but two ports. I didn't really know what I'd do with it besides that, but as the first computer besides in laptop in a long time I wanted it to run a bit more. 

Home Assistant turned out to be a bit disappointing. I won't deny the control you get from it. It's beyond what other systems can do, and with all the plugins you can use almost anything. That brings it's own problems though. You end up relying on it to tie everything together. It's scripting system, even though it's far more capable than others, is just yaml config files trying to be a programming language.  It's painful to write anything in.  Lastly, it's a large single point of failure. It orchestrates everything, and if that server goes down, so does everything in your house. I live alone, but I work at home. When all my lights failed the first time that's all it took for me to go back to using the Hue hub and using Home Assistant only a few automations that couldn't be done any other way. With the way it's packaged and using Docker for it's Addons, it's not something that's easily made high availablity with failover. Especially the case if you have USB dongles for zigbee, bluetooth or other things. Something I hope to tackle in the future. Backups work for the most part, but it makes hard to work on large changes or debug things while still wanting to use your home.

Still, all this got me thinking about actually making my home smart. Could I use machine learning models to replace these simple scripts of if/this/then/that? Something that could learn and adapt. I didn't know anything about machine learning then, and I still don't know much. But if you know something, that probably sounds rediculous. Talking with some others that have tried it in the past, there are challenges with it. I've spent a lot of time thinking on it though, and I at least have ideas of how to deal with the ones I know about. Something I will hopefully write more on later. 

## Finally, the lab

Lastly it finally comes to the home lab. I had setup Frigate with several cameras indoors. I tried some automations with it, but the reaction time is a little slow and accuracy had something to be desired with the models I was using. I had a USB Coral, but that just can't handle a lot, especially multiple cameras are higher frame rates. Hits against my cats weren't great, which I wanted to use to determine if a person or a cat set off a sensor. I needed better models and to be able to finetune models I was using with data from my own home. That means a GPU.  Expensive, large, noisy. In my small Nuc 9 Extreme there weren't a lot of options, but I had my eyes on a 16B 4060Ti that all my friends informed me was crap. Unfortunately for me, prices seemed to go up rather than down. They are still a good option for LLMs. I knew I still had a problem with data, handling backups. If I started on a new project I wouldn't want to lose the data. I've had triple drive failures twice with Raid 6 in the past, so I don't really look at this as a trivial problem. 

So I had a lot of conflicts. I didn't want it to be noisy or too big. I wanted storage I could depend on, but largish arrays of disks are both loud and big. I wanted high availability and be able to create a development or pre-prod area where I could test things for major problems before I upgrade and have reliable ways to revert. I'd bought new memory for a small NAS I was relucant to build, then I read about Ceph, and it capitavated me. 

## Ceph, love at first sight

I loved it's redundant storage. It did exactly what I was planning on doing anything, just make a pile of copies of things. It used multiple nodes, which I figured I could also use to do my processing and giving me the ability to have HA. Then came the downsides, one after another. Need a fast network, to really have it work you needed more than three nodes. Really, many more. You need a lot of storage to split it all over. Then more hit. It's terrible with consumer SSDs. I had looked at cheap miniPCs, but most enterprise SSDs are longer than normal, 110mm and won't fit in most cases with 80mm. (You'll see this as 2280 and 22110). My Nuc only had 1Gbe. I had one slot, so I could put a network card in it, but then I couldn't use it for a GPU. I was hoping I could use some cheaper miniPCs.  I was stuck between the place of a NAS, big, maybe loud, single point of failure, possibly noisy GPUs, especially in a small case and lack of high availability.  Eventually though it started to come together. 

My plan, use my Nuc 9 Extreme, along with two Minisforum MS-01 for a three node cluster. First off, the SSDs. It turns out the Nuc 9 Extreme can actually use m.2 22110 SSDs in two slots.  Perfect. The MS-01 can too, except one has a post you can't remove. That is the slot that takes U.2 storage, another form of enterprise SSDs. Great. Plus it already has 10GBe networking built in. Ceph is only as fast as your slowest node, but I can use the slot in the Nuc 9 for networking. Great, I have storage, now how about the AI?

The Minisforum can take a GPU.  Granted I'm looking at the RTX A2000, RTX 2000 ADA and RTX 4000 ADA SFF.  These tend to be more expensive for the power than some of the gaming siblings, but in return they are small, use less wattage and are more quiet. Those greatly appealed to me. n3rdhardware makes custom coolers so these can fit in a single slot. Perfect, I have two machines I can put them in. If I can put a network card in my PCIEx4 slot in the Nuc, I can also put a GPU in there. Too hot? maybe, but there are ways to deal with it. They'll be used all the time, but it doesn't mean they'll be pushed all the the time either. Three machines, all with dual 10GBe networking, at least 2 SSDs of storage for Ceph and a boot drive and all three can take a GPU and probably pushing the cooling limits. Still, it's a plan, it deals with the performance issues of Ceph (later) and I can run models on it. 

## A bit of justifications

I'll just say here, I'm more interested in running a variety of models related to object recognition, posture, face ID, re-id, voice and sound rather than a large LLM. Having multiple GPUs isn't a bad thing neccessarily. I end up with a lot more memory for the money VS a large card. (3x2000 ADA with 16GB each cost less than a 6000 ADA with 36GB and the latter would require a new larger machine to house it).  I don't really mind using LLMs in the cloud, at least now. The stuff that needs a quick and constant monitoring is local and I can use a cloud service for LLMs for now. The technology, both software and hardware is developing so fast there is likely to be a better solution soon. 

I didn't know back when I made that decision, but now we have the Framework PC with the AMD cheap and 128GB of ram along with Nvidia's blackwell powered Spark. (previous Digits) and third parties are coming out with options. These aren't cheap, but look far better for running LLMs than investing in large GPUs, plus they should be able to handle everything else including training.  Time will tell, but I think my prediction is right.  This will advance quickly and it's worth putting off purchases until I need them. 

## What's Next? 

I've ordered a lot of the hardware. I have all the machines and even managed to snag another Nuc 9 Extreme since I already have the memory which I bought for the NAS I didn't end up building. I have a 8 port 10Gbe switch. It won't be enough, but it's enough to get me started. I have A2000, two custom coolers on order and I'll get a 2000 ADA when the time comes. I bought the wrong network cards first. Even doing some surgery on the Nuc 9 Extremes with the dremel, the 8x cards I bought wouldn't work in it. Not all due, and sometimes it's just down to power. They worked in the 16x, but I have PCIEx4 Dual SPF+ cards for them now. I ordered 3 Samsung PM983 4TB SSDs. One was bad and it on it's way back. I ordered more SSDs as I need at least three nodes to really start using Ceph. I ordered one PM983 8TB SSD.  This one is a little odd as it's not the 22mm wide the normal ones are. It's 30mm. That won't fit in a lot of slots, but I'm 97% sure that both of m.2 22110 slots in the Nuc 9 Extreme can squeeze it in. I bought one to check and have my fingers crossed. 

Next up I want to start working on getting these setup with Terraform and Ansible. I've already had problems relying on scripts to help people setup VMs in Proxmox. For stuff I did setup, I can't recall all the manual steps.  With multiple machines, I want a documented repeatable process so going this route makes sense. Hopefully that will be the next series of posts.  Getting as much of the proxmox config as I can automated as well as Ceph. If I make changes later it will help if it's already in there.  After that it's going to be a lot of the core services. DHCP, DNS, Nginx. The plan after that can start to take some different directions. 
